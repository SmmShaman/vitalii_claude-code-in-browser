-- Add processed_image_url column to store AI-generated images
-- This column stores the URL of images processed/generated by AI (Gemini/Imagen)

-- Add to news table
ALTER TABLE news
ADD COLUMN IF NOT EXISTS processed_image_url TEXT,
ADD COLUMN IF NOT EXISTS image_processed_at TIMESTAMPTZ;

-- Add to blog_posts table
ALTER TABLE blog_posts
ADD COLUMN IF NOT EXISTS processed_image_url TEXT,
ADD COLUMN IF NOT EXISTS image_processed_at TIMESTAMPTZ;

-- Add comments for documentation
COMMENT ON COLUMN news.processed_image_url IS 'URL of AI-processed/generated image for this news article';
COMMENT ON COLUMN news.image_processed_at IS 'Timestamp when image was processed by AI';
COMMENT ON COLUMN blog_posts.processed_image_url IS 'URL of AI-processed/generated image for this blog post';
COMMENT ON COLUMN blog_posts.image_processed_at IS 'Timestamp when image was processed by AI';

-- Create index for faster queries on processed images
CREATE INDEX IF NOT EXISTS idx_news_processed_image ON news(processed_image_url) WHERE processed_image_url IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_blog_posts_processed_image ON blog_posts(processed_image_url) WHERE processed_image_url IS NOT NULL;
