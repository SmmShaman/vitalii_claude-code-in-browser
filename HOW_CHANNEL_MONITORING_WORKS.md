# 📱 Як Працює Автоматичний Моніторинг Каналів

## 🎯 Головна Ідея

**Ви керуєте ВСІМ через Admin Dashboard - без SQL, без коду!**

```
┌─────────────────────────────────────────────┐
│  Admin Dashboard → Settings → News Sources  │
│  👆 Тут ви додаєте/видаляєте канали         │
└────────────────┬────────────────────────────┘
                 │
                 │ (Автоматично)
                 ▼
┌─────────────────────────────────────────────┐
│  Telegram Bot                               │
│  🤖 Читає з БД які канали моніторити        │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│  Пости з Telegram Каналів                   │
│  📰 Автоматично обробляються                │
└─────────────────────────────────────────────┘
```

---

## ✅ Крок 1: Додати Канал через Dashboard

### Відкрийте:
```
🌐 https://remarkable-monstera-e6ecfa.netlify.app/admin/dashboard
   → Settings → News Sources
```

### Два способи додати:

#### Спосіб A: Швидке додавання ⚡
```
┌───────────────────────────────────────────┐
│ 📱 Швидке Додавання Telegram Каналу      │
├───────────────────────────────────────────┤
│ [@geekneural] [Додати]                   │
└───────────────────────────────────────────┘
```

1. Вставте `@geekneural` або `https://t.me/geekneural`
2. Натисніть "Додати"
3. Готово! ✅

#### Спосіб B: Повна форма
```
[+ Add Source]

Name: geekneural
URL: https://t.me/geekneural
Source Type: telegram
Category: tech
Is Active: ✅ (true)
Fetch Interval: 1 година (3600)

[Save]
```

---

## ✅ Крок 2: Моніторинг Каналів

### ⚠️ Важлива Примітка:

Якщо ви **НЕ власник** каналів, ви не можете додати бота як адміна для автоматичного моніторингу.

### Два способи отримувати пости:

#### Спосіб A: Ручна Пересилка (Працює ЗАРАЗ)
```
Ви бачите пост → Forward боту → Бот обробляє
```

1. Відкрийте канал у Telegram
2. Виберіть пост
3. Forward → ваш бот
4. Готово! ✅

#### Спосіб B: Автоматичний (Потрібні додаткові налаштування)

Для автоматичного моніторингу публічних каналів:
- Self-hosted RSS Bridge
- Telegram Client API

Детальніше: `HOW_TO_MONITOR_TELEGRAM_CHANNELS.md`

---

## 🎛️ Крок 3: Керування Каналами

### Активувати/Деактивувати

Просто натисніть **toggle** біля каналу:

```
┌──────────────────────────────────────────┐
│ 🟢 geekneural          [✓ Active]  [↻]  │
│ https://t.me/geekneural                  │
│ Last fetch: 2 хв тому                    │
└──────────────────────────────────────────┘
       ↓ (натискаєте toggle)
┌──────────────────────────────────────────┐
│ ⚫ geekneural          [✗ Inactive] [↻]  │
│ https://t.me/geekneural                  │
│ ⚠️ Бот НЕ буде моніторити цей канал     │
└──────────────────────────────────────────┘
```

**is_active = false** → Бот ігнорує пости з цього каналу!

### Змінити Інтервал Fetch

Для RSS каналів:
```
Fetch Interval: [▼ 1 година]
  ├─ 15 хвилин
  ├─ 30 хвилин
  ├─ 1 година  ✓
  ├─ 2 години
  └─ 6 годин
```

Для Telegram каналів інтервал не важливий - пости приходять миттєво!

---

## 🤖 Як Бот Визначає Які Канали Моніторити?

### Код бота (автоматично):

```typescript
// Кожен раз коли приходить channel_post:
const { data: sources } = await supabase
  .from('news_sources')
  .select('url')
  .eq('source_type', 'telegram')
  .eq('is_active', true)  // ← ТІЛЬКИ активні!

// Отримуємо usernames:
// ['geekneural', 'digital_gpt4_neyroseti']

if (!allowedChannels.includes(channelUsername)) {
  console.log('⚠️ Пропускаємо - канал не в списку або деактивований')
  return
}

// Обробляємо пост!
```

**Ви нічого не чіпаєте в коді - бот читає з БД автоматично!**

---

## 📊 Приклад Workflow

### Початковий стан:
```sql
SELECT name, is_active FROM news_sources WHERE source_type = 'telegram';
```
```
name                    | is_active
------------------------|----------
geekneural              | true   ✅
digital_gpt4_neyroseti  | false  ❌
```

**Результат:**
- Пости з @geekneural → Обробляються ✅
- Пости з @digital_gpt4_neyroseti → Ігноруються ❌

---

### Ви деактивуєте geekneural через UI:

```
Dashboard → Settings → News Sources
  → geekneural → [Toggle OFF]
```

**Результат:**
```
name                    | is_active
------------------------|----------
geekneural              | false  ❌
digital_gpt4_neyroseti  | false  ❌
```

- Пости з @geekneural → Ігноруються ❌
- Пости з @digital_gpt4_neyroseti → Ігноруються ❌

**Бот не обробляє ЖОДНОГО каналу!**

---

### Ви активуєте обидва:

```
Dashboard → Toggle ON для обох каналів
```

**Результат:**
```
name                    | is_active
------------------------|----------
geekneural              | true   ✅
digital_gpt4_neyroseti  | true   ✅
```

- Пости з ОБОХ каналів → Обробляються ✅

---

## 🧪 Тестування

### Тест 1: Додати новий канал

1. Dashboard → News Sources → Quick Add
2. Введіть `@test_channel`
3. Додайте бота як адміна в канал
4. Напишіть пост в каналі
5. Через 2-5 сек перевірте БД:
   ```sql
   SELECT * FROM news ORDER BY created_at DESC LIMIT 1;
   ```
6. Нова новина має з'явитися! ✅

### Тест 2: Деактивувати канал

1. Dashboard → Toggle OFF для каналу
2. Напишіть пост в цьому каналі
3. Перевірте БД - новина НЕ має з'явитися ❌
4. Перевірте логи бота:
   ```
   "⚠️ Skipping post from non-allowed channel: test_channel"
   ```

### Тест 3: Реактивувати

1. Dashboard → Toggle ON
2. Напишіть пост
3. Новина з'явиться! ✅

---

## 💡 Переваги Такого Підходу

### ✅ Без SQL запитів
Раніше:
```sql
INSERT INTO news_sources (name, url, source_type, is_active)
VALUES ('new_channel', 'https://t.me/new_channel', 'telegram', true);
```

Тепер:
```
Dashboard → Quick Add → [@new_channel] → [Додати] ✨
```

### ✅ Миттєва активація/деактивація
```
[Toggle] → Готово! (0 секунд)
```

### ✅ Без перезапуску бота
Бот перевіряє список при кожному пості → зміни застосовуються миттєво!

### ✅ Централізоване керування
Всі джерела (RSS, Web, Telegram) в одному місці:
```
Dashboard → Settings → News Sources
  ├─ TechCrunch (RSS) ✅
  ├─ Hacker News (RSS) ❌
  ├─ geekneural (Telegram) ✅
  └─ digital_gpt4 (Telegram) ✅
```

---

## 🎯 Чек-лист для Нових Каналів

Коли додаєте новий Telegram канал:

- [ ] Додати через Dashboard (Quick Add або форма)
- [ ] Переконатися що `is_active = true` (зелений toggle)
- [ ] Додати бота як адміна в канал
- [ ] Написати тестовий пост
- [ ] Перевірити що новина з'явилася в БД
- [ ] Натиснути ✅ Publish в Telegram боті

**Все! Канал працює автоматично!** 🎉

---

## 🚨 FAQ

**Q: Скільки каналів можна додати?**
A: Необмежено! Бот обробить всі активні.

**Q: Чи потрібно перезапускати бота після додавання каналу?**
A: НІ! Бот перевіряє список при кожному пості.

**Q: Що якщо я видалю канал з Dashboard?**
A: Бот перестане його моніторити миттєво.

**Q: Чи можу я тимчасово вимкнути моніторинг всіх каналів?**
A: Так! Toggle OFF для всіх каналів → бот їх ігноруватиме.

**Q: Як побачити які канали зараз активні?**
A: Dashboard → News Sources → дивіться зелені toggle ✅

---

**Створено:** 2025-10-27
**Версія:** 1.0
**Автор:** Claude Code 🤖
