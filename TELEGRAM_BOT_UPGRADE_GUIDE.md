# üöÄ Telegram Bot Upgrade Guide

## üìã –©–æ –ó–º—ñ–Ω–∏–ª–æ—Å—è

–í–∞—à Telegram –±–æ—Ç **–í–ñ–ï —ñ—Å–Ω—É—î** —ñ –ø—Ä–∞—Ü—é—î, –∞–ª–µ –æ–±—Ä–æ–±–ª—è—î —Ç—ñ–ª—å–∫–∏ –∫–Ω–æ–ø–∫–∏ Publish/Reject.

**–î–æ–¥–∞—î–º–æ 2 –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:**
1. ‚úÖ **–†—É—á–Ω–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è** - –≤–∏ –ø–∏—à–µ—Ç–µ –±–æ—Ç—É —Ç–µ–∫—Å—Ç/—Ñ–æ—Ç–æ ‚Üí –±–æ—Ç –æ–±—Ä–æ–±–ª—è—î
2. ‚úÖ **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª—ñ–≤** - –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—î –ø–æ—Å—Ç–∏ –∑ –∫–∞–Ω–∞–ª—ñ–≤

---

## üéØ –ö—Ä–æ–∫ 1: –ó–∞–º—ñ–Ω–∏—Ç–∏ –ö–æ–¥ Edge Function

### –ü–æ—Ç–æ—á–Ω–∏–π —Ñ–∞–π–ª:
```
supabase/functions/telegram-webhook/index.ts
```

### –ù–æ–≤–∏–π —Ñ–∞–π–ª:
```
supabase/functions/telegram-webhook/index-UPDATED.ts
```

**–©–æ —Ä–æ–±–∏—Ç–∏:**

```bash
# 1. –ü–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏ —Å—Ç–∞—Ä–∏–π —Ñ–∞–π–ª (backup)
mv supabase/functions/telegram-webhook/index.ts supabase/functions/telegram-webhook/index-OLD.ts

# 2. –ü–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π —Ñ–∞–π–ª
mv supabase/functions/telegram-webhook/index-UPDATED.ts supabase/functions/telegram-webhook/index.ts

# 3. –ó–∞–¥–µ–ø–ª–æ—ó—Ç–∏
cd supabase
./deploy.sh telegram-webhook
```

---

## üéØ –ö—Ä–æ–∫ 2: –î–æ–¥–∞—Ç–∏ –ë–æ—Ç–∞ –≤ –ö–∞–Ω–∞–ª–∏

### –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–∞–Ω–∞–ª—É:

1. **–í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–∞–Ω–∞–ª** (–Ω–∞–ø—Ä. @geekneural)

2. **–î–æ–¥–∞—Ç–∏ –±–æ—Ç–∞ —è–∫ –∞–¥–º—ñ–Ω–∞:**
   ```
   Subscribers ‚Üí Add Administrator ‚Üí –ø–æ—à—É–∫–∞—Ç–∏ @your_bot ‚Üí –î–æ–¥–∞—Ç–∏
   ```

3. **–ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞:**
   - ‚úÖ –ú–æ–∂–Ω–∞ –≤–∑–∞–≥–∞–ª—ñ –±–µ–∑ –ø—Ä–∞–≤!
   - –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ—Å—Ç—ñ–≤

### –í–∞—à—ñ –∫–∞–Ω–∞–ª–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è:
- [ ] @digital_gpt4_neyroseti
- [ ] @geekneural

---

## üéØ –ö—Ä–æ–∫ 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª—É

1. –ù–∞–ø–∏—à—ñ—Ç—å –ø–æ—Å—Ç –≤ –æ–¥–Ω–æ–º—É –∑ –≤–∞—à–∏—Ö –∫–∞–Ω–∞–ª—ñ–≤ (–Ω–∞–ø—Ä. @geekneural)
2. –ß–µ—Ä–µ–∑ 1-5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
   ```sql
   SELECT * FROM news ORDER BY created_at DESC LIMIT 1;
   ```
3. –ù–æ–≤–∞ –Ω–æ–≤–∏–Ω–∞ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è –∑ `is_published = false`

### –¢–µ—Å—Ç 2: –†—É—á–Ω–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è

1. –ù–∞–ø–∏—à—ñ—Ç—å –±–æ—Ç—É (@your_bot) –±—É–¥—å-—è–∫–∏–π —Ç–µ–∫—Å—Ç
2. –ë–æ—Ç –º–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏: `‚úÖ Your message has been sent for processing...`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ë–î - –Ω–æ–≤–∞ –Ω–æ–≤–∏–Ω–∞ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è

### –¢–µ—Å—Ç 3: –ü–µ—Ä–µ—Å–ª–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

1. –ü–µ—Ä–µ—à–ª—ñ—Ç—å –±–æ—Ç—É –ø–æ—Å—Ç –∑ –∫–∞–Ω–∞–ª—É (Forward)
2. –ë–æ—Ç –º–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏: `‚úÖ Forwarded message sent for processing!`
3. –ù–æ–≤–∏–Ω–∞ –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è –≤ –ë–î

### –¢–µ—Å—Ç 4: –ö–Ω–æ–ø–∫–∏ (–º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫ —Ä–∞–Ω—ñ—à–µ)

1. –ü—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –Ω–æ–≤–∏–Ω–∏ –±–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –∫–Ω–æ–ø–∫–∏
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ‚úÖ Publish
3. –ù–æ–≤–∏–Ω–∞ –º–∞—î –æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏—Å—è (`is_published = true`)

---

## üìä –ù–æ–≤—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—î **–í–°–Ü** –Ω–æ–≤—ñ –ø–æ—Å—Ç–∏ –∑ –∫–∞–Ω–∞–ª—ñ–≤ –¥–µ –≤—ñ–Ω –∞–¥–º—ñ–Ω.

**–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è:**
- –û–±—Ä–æ–±–ª—è—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–∞–Ω–∞–ª–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ `news_sources` –¥–µ:
  - `source_type = 'telegram'`
  - `is_active = true`

### 2. –†—É—á–Ω–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è

–ù–∞–¥—ñ—à–ª—ñ—Ç—å –±–æ—Ç—É:
- –¢–µ–∫—Å—Ç
- –¢–µ–∫—Å—Ç + —Ñ–æ—Ç–æ
- –¢—ñ–ª—å–∫–∏ —Ñ–æ—Ç–æ –∑ –ø—ñ–¥–ø–∏—Å–æ–º

–ë–æ—Ç –æ–±—Ä–æ–±–∏—Ç—å —ñ –Ω–∞–¥—ñ—à–ª–µ –Ω–∞ AI –ø–µ—Ä–µ–∫–ª–∞–¥.

### 3. –ü–µ—Ä–µ—Å–ª–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

–Ø–∫—â–æ –ø–µ—Ä–µ—à–ª—ñ—Ç—å –±–æ—Ç—É –ø–æ—Å—Ç –∑ –∫–∞–Ω–∞–ª—É - –≤—ñ–Ω —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —Ü–µ —ñ –æ–±—Ä–æ–±–∏—Ç—å —è–∫ –ø–æ—Å—Ç –∑ –∫–∞–Ω–∞–ª—É.

---

## üîç Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç—Ä–∏–º—É—î –ø–æ—Å—Ç–∏ –∑ –∫–∞–Ω–∞–ª—É

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–æ—Ç –Ω–µ —î –∞–¥–º—ñ–Ω–æ–º
**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ —è–∫ –∞–¥–º—ñ–Ω–∞ (–¥–∏–≤. –ö—Ä–æ–∫ 2)

### –ë–æ—Ç –æ–±—Ä–æ–±–ª—è—î –Ω–µ —Ç—ñ –∫–∞–Ω–∞–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–∞–Ω–∞–ª –Ω–µ –≤ —Å–ø–∏—Å–∫—É –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö
**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∞–±–ª–∏—Ü—é `news_sources`:

```sql
SELECT * FROM news_sources WHERE source_type = 'telegram';
```

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ:
- `url` –º—ñ—Å—Ç–∏—Ç—å `https://t.me/channel_username`
- `is_active = true`

### –ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

**–ü—Ä–∏—á–∏–Ω–∞:** Edge Function –Ω–µ –∑–∞–¥–µ–ø–ª–æ—î–Ω–∞ –∞–±–æ webhook –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
**–†—ñ—à–µ–Ω–Ω—è:**

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ webhook
./setup-telegram-webhook.ps1
```

–ê–±–æ –≤—Ä—É—á–Ω—É:
```
https://api.telegram.org/bot{YOUR_TOKEN}/setWebhook?url=https://uchmopqiylywnemvjttl.supabase.co/functions/v1/telegram-webhook
```

### –§–æ—Ç–æ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ getFile
**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Edge Function:

```
Supabase Dashboard ‚Üí Edge Functions ‚Üí telegram-webhook ‚Üí Logs
```

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –û–Ω–æ–≤–ª–µ–Ω–æ–≥–æ –ö–æ–¥—É

```typescript
// –û–±—Ä–æ–±–Ω–∏–∫ channel_post (–ù–û–í–ò–ô!)
if (update.channel_post) {
  // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –∫–∞–Ω–∞–ª –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π
  // 2. –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–µ–∫—Å—Ç —ñ —Ñ–æ—Ç–æ
  // 3. –í–∏–∫–ª–∏–∫–∞—Ç–∏ process-news
}

// –û–±—Ä–æ–±–Ω–∏–∫ message (–ù–û–í–ò–ô!)
if (update.message) {
  // 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —Ü–µ forwarded –∑ –∫–∞–Ω–∞–ª—É
  // 2. –û—Ç—Ä–∏–º–∞—Ç–∏ —Ç–µ–∫—Å—Ç —ñ —Ñ–æ—Ç–æ
  // 3. –í–∏–∫–ª–∏–∫–∞—Ç–∏ process-news
}

// –û–±—Ä–æ–±–Ω–∏–∫ callback_query (–Ü–°–ù–£–Æ–ß–ò–ô - –ë–ï–ó –ó–ú–Ü–ù!)
if (update.callback_query) {
  // Publish/Reject –∫–Ω–æ–ø–∫–∏
}
```

---

## ‚úÖ Checklist Deployment

- [ ] –ó–∞–º—ñ–Ω–∏–≤ –∫–æ–¥ (index-UPDATED.ts ‚Üí index.ts)
- [ ] –ó–∞–¥–µ–ø–ª–æ—ó–≤ Edge Function (`./deploy.sh telegram-webhook`)
- [ ] –î–æ–¥–∞–≤ –±–æ—Ç–∞ —è–∫ –∞–¥–º—ñ–Ω–∞ –≤ –∫–∞–Ω–∞–ª–∏:
  - [ ] @digital_gpt4_neyroseti
  - [ ] @geekneural
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ (–ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞–≤ —Ä—É—á–Ω—É –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é (–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±–æ—Ç—É)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞–≤ –∫–Ω–æ–ø–∫–∏ Publish/Reject
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤ —â–æ –Ω–æ–≤–∏–Ω–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è –≤ –ë–î
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤ —â–æ AI –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –ø—Ä–∞—Ü—é—é—Ç—å

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü—ñ—Å–ª—è deployment –≤–∞—à –±–æ—Ç –±—É–¥–µ:

1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–∏—Ç–∞—Ç–∏** –Ω–æ–≤—ñ –ø–æ—Å—Ç–∏ –∑ –∫–∞–Ω–∞–ª—ñ–≤
2. ‚úÖ **–ü—Ä–∏–π–º–∞—Ç–∏ —Ä—É—á–Ω—ñ** –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –≤–∞—Å
3. ‚úÖ **–û–±—Ä–æ–±–ª—è—Ç–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω—ñ** –ø–æ—Å—Ç–∏ –∑ –∫–∞–Ω–∞–ª—ñ–≤
4. ‚úÖ **–ü—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏** (—è–∫ —Ä–∞–Ω—ñ—à–µ)

**–í—Å–µ –≤ –æ–¥–Ω–æ–º—É –±–æ—Ç—ñ!** üöÄ

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** 2025-10-27
**–ë–æ—Ç Token:** `8223281731:AAEUlmDSJCG1RVm2uGOSX-atnQiLEXNfXd8`
**Webhook:** `https://uchmopqiylywnemvjttl.supabase.co/functions/v1/telegram-webhook`
